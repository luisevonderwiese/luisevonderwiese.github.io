<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Brache</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
<style>


body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }


	.mapboxgl-popup {
max-width: 400px;
font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
padding-top: -20px;
}

.marker {
background-size: cover;
cursor: pointer;
#-webkit-transform-origin: 0px 0px;
#-moz-transform-origin: 0px 0px;
#-ms-transform-origin: 0px 0px;
#-o-transform-origin: 0px 0px;
#transform-origin: 0px 0px;
#-webkit-transform: rotate(30deg);
#-moz-transform: rotate(30deg);
#-ms-transform: rotate(30deg);
#-o-transform: rotate(30deg);
#transform: rotate(30deg);
}



.button2{
	position: absolute;
	top: -10%;
	left: -10%;
	display:block;
	cursor: pointer;
	width:120%;
	height:120%;
	border:0.5em solid #FFFFFF;
	border-radius:0.5em;
	box-sizing: border-box;
    background: transparent;
    font-size:0;
}

.overlay {
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    text-align: left;
    background-color: #333333;
	padding: 2%;
    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
	border-radius:0.1em;
	color: white;
    opacity: 0;
    transition: opacity .2s ease-out;
}

.innerbutton{
     margin-top: 1px;
     margin-right: 2px;
     position:absolute;
     top:0;
     right:0;
	display:block;
	cursor: pointer;
	border: transparent;
    background: transparent;
    font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
	color: #F3F3F3;
}

</style>
</head>
<body>

<div id="map"></div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoibHVpc2UtaGFldXNlciIsImEiOiJja2d3MHEybHQwNW5pMzBycm9rOXFndzV0In0.0DUrtkqAOlmHkX8BXtixmw';
var items = {
'type': 'geojson',
'data': {
  "type": "FeatureCollection",
  "features": [
  {
      "type": "Feature",
      "properties": {
			'description': 'Maria Tackmann, Öl auf Brache, 2021.',
            'icon': 'https://image.flaticon.com/icons/png/512/808/808569.png',
            'iconSize': [10, 10],
			'rotation' : 90,
			'begin' : '2021-09-14-00-00',
			'end' : '2021-11-07-23-59',
			'begin_daily' : '00-00',
			'end_daily' : '23-59',
			'area' : {'type': 'geojson',
				'data': {'type': 'Feature',
							'geometry': {'type': 'Polygon','coordinates': [[
            [
			  8.349302262067795,
              49.01907291804756
            ],
            [
              8.349264711141586,
              49.019063243472445
            ],
            [
              8.34925130009651,
              49.01904125579471
            ],
            [
              8.349296897649765,
              49.01901750909186
            ],
            [
              8.349330425262451,
              49.019029822198455
            ],
            [
              8.349337130784988,
              49.01905972544465
            ],
            [
              8.349302262067795,
              49.01907291804756
            ]]]}}}},
      "geometry": {
        "type": "Point",
        "coordinates": [
              8.34928,
              49.019025
            ]
      }
    },
    {
      "type": "Feature",
      "properties": {
			'description': 'Maria Tackmann, Papier auf Sand, 2021.',
            'icon': 'https://image.flaticon.com/icons/png/512/51/51473.png',
            'iconSize': [30,30],
			'rotation' : 90,
			'begin' : '2021-09-14-00-00',
			'end' : '2021-11-07-23-59',
			'begin_daily' : '00-00',
			'end_daily' : '23-59'},
      "geometry": {
        "type": "Point",
        "coordinates": [
          8.349123895168304,
          49.018904052466226
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
			'description': 'Pappbecher in Vegetation, Unbekannt, 2021.',
            'icon': 'https://image.flaticon.com/icons/png/512/808/808569.png',
            'iconSize': [15,15],
			'rotation' : 0,
			'begin' : '1970-01-01-00-00',
			'end' : '2100-12-31-23-59',
			'begin_daily' : '00-00',
			'end_daily' : '23-59'},
      "geometry": {
        "type": "Point",
        "coordinates": [
          8.349451124668121,
          49.018868872064665
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
			'description': 'David Heitz, Fotografie, 2021.',
            'icon': 'https://image.flaticon.com/icons/png/512/591/591881.png',
            'iconSize': [15,15],
			'rotation' : 30, 
			'begin' : '1970-01-01-00-00',
			'end' : '2100-12-31-23-59',
			'begin_daily' : '21-00',
			'end_daily' : '21-45'},
      "geometry": {
        "type": "Point",
        "coordinates": [
          8.349448442459106,
          49.01910106225542
        ]
      }
    }
  ]
}
}

var map = new mapboxgl.Map({
container: 'map',
style: 'mapbox://styles/luise-haeuser/cktemen6q2gba17s0txukk39c', 
center: [8.349325060844421, 49.01890053442718], 
zoom: 18.5,
maxZoom: 19,
minZoom: 18
});

map.addControl(
new mapboxgl.GeolocateControl({
positionOptions: {
enableHighAccuracy: true
},
// When active the map will receive updates to the device's location as it changes.
trackUserLocation: true,
// Draw an arrow next to the location dot to indicate which direction the device is heading.
showUserHeading: true
})
);






map.on('load', () => {

/*map.addSource('route', {
'type': 'geojson',
'data':{"type":"Feature","properties":{},"geometry":{"type":"LineString","coordinates":[[8.354944376284067,49.01379225104881],[8.354922897244364,49.01390110977874],[8.354506984916185,49.01383835595246],[8.354280478672138,49.01365905886635],[8.353901666504782,49.013861408388124],[8.353764981701545,49.013843478715415], [8.353764981702597,49.01384347870902],[8.353077652409468,49.013936969067004], [8.353080249580756,49.01393728459317],[8.352258750722257,49.01410263063062],[8.352252315783659,49.01410374700404],[8.35223416552185,49.0141080872186],[8.352206031767054,49.01411713791532],[8.352169646348528,49.01413238573198],[8.352126741098687,49.01415531730416],[8.3520790478469,49.01418741925971],[8.35202829842325,49.014230178219975],[8.351976224659268,49.01428508079323], [8.351978397948784,49.014283655399396],[8.351930585846304,49.01434779787763],[8.352047942825465,49.01437345484632],[8.352051686635889,49.0143760327918],[8.352061593724528,49.014382853489224],[8.352091951693296,49.014403744305355],[8.352123124640883,49.01442516963206],[8.352134050453827,49.014432658471975],[8.352139220476317,49.01443617182315],[8.35213993676706,49.014441379906714],[8.35214046841341,49.014455119417335],[8.352140834517513,49.014476166800506],[8.352141054179327,49.014503298500784],[8.35214114650205,49.014535290962186],[8.352141130583618,49.01457092063055],[8.352140850434921,49.01464819738416],[8.35214036654071,49.01472534038865],[8.35214009594202,49.01476080288484],[8.352139831710616,49.01479256133041],[8.352139592947765,49.01481939219303],[8.352139398753337,49.014840071943524],[8.352139268229507,49.01485337705063],[8.352139220476317,49.0148580839828],[8.352132800924892,49.01485834323637],[8.352114656499054,49.014859088981865],[8.352086458543454,49.01486027319697],[8.35204987840126,49.014861847857816],[8.352006587414962,49.01486376494242],[8.351958256931113,49.0148659764277],[8.351853162838921,49.01487109050862],[8.35174796687403,49.01487680591805],[8.351699509048956,49.01487976906364],[8.351656039786718,49.01488273847295],[8.351619230431737,49.01488566612352],[8.351590752327297,49.014888503991756],[8.351572276815887,49.01489120405563],[8.351565475242978,49.01489371829183], [8.351563301975204,49.014891358371415],[8.351558008856756,49.01489131382863],[8.351543368946153,49.01489153654296],[8.351521241416833,49.01489256102877],[8.351493485438226,49.01489492180096],[8.351428524818175,49.01490579025983],[8.351395038518518,49.014915366973725],[8.351363360453547,49.014928418027296],[8.351304546134855,49.01495973163341],[8.351253066626299,49.01499077796322],[8.351232114874023,49.015004781098895],[8.351215441761155,49.015017013655864],[8.351203862267539,49.01502690771534],[8.351198191370855,49.01503389535915],[8.351195466816051,49.015038155455045],[8.351189943953443,49.01504539295394],[8.351171738510487,49.01506761420586],[8.351146045447848,49.015098187202625],[8.3511153351713,49.01513474003201],[8.35104874459256,49.01521629756644],[8.35101780510206,49.015256558476665],[8.350991730017938,49.0152933116311], [8.350991730019985,49.01529188626512],[8.350598366810203,49.0159475477559], [8.350592182513367,49.01594744875206],[8.350590633919637,49.0159498552909],[8.350586053659242,49.01595697740353],[8.350578540008712,49.0159686688346],[8.35056819124793,49.01598478332741],[8.350555105656497,49.01600517462313],[8.350539381512164,49.01602969646339],[8.350521117094502,49.016058202588454],[8.350500410681349,49.01609054673784],[8.350477360553356,49.01612658265097],[8.350452064987081,49.01616616406645],[8.350424622263404,49.01620914472258],[8.35039513065891,49.01625537835781],[8.350330393928317,49.01635701951818],[8.350258641025874,49.016469917451985],[8.350180658181046,49.01659290206712],[8.350097231626421,49.01672480327582],[8.350009147590555,49.01686445099804],[8.349917192304872,49.01701067516265],[8.349822151999973,49.01716230570875],[8.349724812906402,49.01731817258832],[8.349526383277293,49.017637935223064],[8.349328193260789,49.017960602961864],[8.349231153683661,49.01812010127756],[8.349136532702005,49.01827681593821],[8.349045116545426,49.01842957699742],[8.348957691446401,49.018577214522765],[8.348875043633484,49.018718558593264],[8.348797959338128,49.0188524393005],[8.348727224790906,49.01897768674456],[8.348663626223356,49.01909313103326],[8.348607949863975,49.01919760228054],[8.348583328210424,49.01924535742506],[8.348560981945468,49.01928993060335],[8.348541009347741,49.01933117557928],[8.348523508697099,49.01936894611808],[8.348508578271066,49.01940309598319],[8.348496316349525,49.01943347893902],[8.348486821211026,49.01945994874876],[8.348480191134257,49.0194823591753],[8.34847652439808,49.0195005639803],[8.34847591928093,49.019514416925176], [8.34845547229662,49.019514416927535],[8.348454261751272,49.01951648264736],[8.348451059421535,49.0195224571936],[8.348446509267575,49.0195320066444],[8.348441255250634,49.01954479707882],[8.348431211466135,49.01957876520862],[8.34842607975122,49.01962169020638],[8.348431011789103,49.01967090069823],[8.348451159260009,49.019723725317874],[8.348468548684338,49.01975065812621],[8.34849167384806,49.019777492709096],[8.348521178711394,49.01980389514799],[8.3485577072355,49.0198295315266],[8.348580233054065,49.01984423331743],[8.348607324626641,49.01986299858575],[8.348638635636547,49.01988553023904],[8.348673819768209,49.01991153118334],[8.348712530705939,49.01994070432622],[8.348754422134135,49.01997275257372],[8.348846361195427,49.02004428601086],[8.34894686642707,49.02012375475613],[8.349053167301065,49.020208782081056],[8.349272073869969,49.02038600562639],[8.349379138510926,49.02047344846508],[8.349480916687128,49.0205569431219],[8.349574637871598,49.020634112946],[8.349657531537389,49.020702581300185],[8.34969405226147,49.02073280972937],[8.349726827157411,49.020759971556004],[8.349755509910665,49.02078376970189],[8.349779754205713,49.02080390708963],[8.349799213724651,49.02082008664033],[8.349813542154209,49.020832011275814],[8.349822393176453,49.02083938391624],[8.349825420475895,49.020841907481014],[8.349827062824005,49.02084405171317],[8.349831850095256,49.02084994753267],[8.34985002075851,49.02086977267018],[8.34987825517257,49.020894940370056],[8.34991487604725,49.02091900811712],[8.349958206089468,49.02093553340782],[8.349981862895447,49.02093895435178],[8.350006568008098,49.0209380737451],[8.35003211176732,49.02093208627454],[8.35005828450997,49.020920186624494],[8.350084876575863,49.02090156947739],[8.350111678303989,49.02087542951139],[8.350159361318418,49.020816268350444],[8.350196022128756,49.02076040695036],[8.350223098413437,49.020709259537824],[8.350242027851039,49.020664240342995],[8.350254248121189,49.02062676360012],[8.350261196902267,49.02059824354407],[8.350264311872934,49.02058009440884],[8.350265030712734,49.020573730424985],[8.350264930874232,49.02057200193539],[8.350266148907423,49.02056618792426],[8.35027096113754,49.02055534557786],[8.35028164389064,49.02053853207923],[8.350300473489796,49.02051480460895],[8.350329726260071,49.020483220342754],[8.350371678526614,49.02044283645057],[8.350398128323263,49.02041905000877],[8.3504286066146,49.020392710095564],[8.350447943519384,49.020375727129505],[8.350473079811422,49.02035269932841],[8.350503584934671,49.020324024434416],[8.350539028336101,49.0202901001893],[8.350578979458533,49.02025132433377],[8.350623007748908,49.02020809460873],[8.350670682651156,49.020160808754696],[8.350721573611196,49.020109864512534],[8.350775250074037,49.02005565962489],[8.350831281484517,49.01999859183414],[8.35094868693011,49.01987745852236],[8.351070345509441,49.019749646550196],[8.351192812781903,49.01961833792012],[8.351312644310866,49.019486714666016],[8.35142639565575,49.01935795885515],[8.351530622378903,49.01923525258775],[8.351578087619998,49.019177162447505],[8.351621880040682,49.0191217779938],[8.351661569085934,49.01906949699688],[8.35169672420264,49.019020717228216],[8.351726914833648,49.018975836459305],[8.351751710424992,49.018935252462995],[8.351770680422504,49.01889936301242],[8.351783394271195,49.01886856588058],[8.351789421414963,49.01884325883913],[8.351788331299701,49.01882383966014], [8.35179307744147,49.018831023919404],[8.352610956951935,49.017557118567225], [8.35260073347635,49.017563823427594],[8.353459506961599,49.01663854554073],[8.353461999812339,49.0166348515433],[8.353469266205309,49.016624079752404],[8.353480987905243,49.01660669546928],[8.35349684667608,49.016583163991754],[8.353516524280565,49.01655395061712],[8.353539702483658,49.01651952064168],[8.353566063049186,49.0164803393607],[8.353595287739978,49.016436872069704],[8.35362705832,49.01638958406531],[8.353661056553932,49.01633894064361],[8.353734463037313,49.016229448743076],[8.353812961299951,49.016112118770934],[8.353894005451764,49.01599067315948],[8.353975049603577,49.015868834376334],[8.354053547865192,49.01575032492417],[8.354126954348601,49.01563886734169],[8.354160952582589,49.01558694630313],[8.354192723162527,49.01553818419745],[8.354221947854342,49.0154930463498],[8.354248308418875,49.015451998085695],[8.354271486621968,49.01541550473192],[8.354291164227504,49.01538403161513],[8.35430702299729,49.0153580440616],[8.354318744697196,49.01533800739705],[8.354326011091189,49.01532438694579],[8.354328503940934,49.015317648030674],[8.354329794357568,49.01531210166945],[8.354333555784649,49.01530195738212],[8.3543396234883,49.01528752824268],[8.35434783273459,49.015269127323535],[8.354358018788417,49.0152470676976],[8.35437001691696,49.0152216624366],[8.354398790461062,49.015162067296785],[8.354432835495174,49.01509284648262],[8.354470834144536,49.01501650457885],[8.354553420807036,49.014852475905116],[8.354595373073522,49.01476979837321],[8.354636007468343,49.01469001823045],[8.354674006118728,49.014615640137265],[8.354708051151846,49.01454916876594],[8.35473682469592,49.01449310880008],[8.35474882282449,49.014469765809366],[8.35475900887937,49.01444996492867],[8.354767218124607,49.014434019243964],[8.354773285828259,49.014422241840805],[8.35477704725534,49.01441494580408],[8.354778337671917,49.01441244421795], [8.354768114187067,49.01444597058065],[8.354941913583104,49.013795555153536]]}}
});*/
// Add a data source containing GeoJSON data.
map.addSource('border', {
'type': 'geojson',
'data': {
'type': 'Feature',
'geometry': {
'type': 'Polygon',
'coordinates': [
[
            [
              8.348906636238098,
              49.01894626891527
            ],
            [
              8.349064886569975,
              49.01867186135641
            ],
            [
              8.349700570106506,
              49.01883545066015
            ],
            [
              8.349496722221375,
              49.019218915953
            ],
            [
              8.348906636238098,
              49.01894626891527
            ]
]
]
}
}
});



 

map.addLayer({
'id': 'outline',
'type': 'line',
'source': 'border',
'layout': {},
'paint': {
'line-color': '#000',
'line-width': 1
}
});

/*map.addLayer({
'id': 'r',
'type': 'line',
'source': 'route',
'layout': {},
'paint': {
'line-color': '#8B0000',
'line-width': 5
//line-opacity
}});*/

var i = 0
items.data.features.forEach(function (marker) {
	if(visibleNow(marker)){
		if(map.getSource('area_' + i) == undefined && marker.properties.area != undefined) {
			map.addSource('area_' + i, marker.properties.area);
			map.addLayer({
				'id': 'area_' + i,
				'type': 'line',
				'source': 'area_' + i,
				'layout': {},
				'paint': {
					'line-color': '#000',
					'line-width': 1
				}});
		}
		i++;
	}
});
console.log(map.getSource("area_0")); 
console.log(map.getSource("border")); 
});



function visibleNow(marker) {
	const today = new Date();
	let parts = marker.properties.begin.split('-');
	const begin = new Date(parts[0], parts[1]-1, parts[2], parts[3], parts[4]);
	parts = marker.properties.end.split('-');
	const end = new Date(parts[0], parts[1]-1, parts[2], parts[3], parts[4]);
	parts = marker.properties.begin_daily.split('-');
	const begin_daily = new Date(today.getFullYear(), today.getMonth(), today.getDate(), parts[0], parts[1]);
    parts = marker.properties.end_daily.split('-');
	const end_daily = new Date(today.getFullYear(), today.getMonth(), today.getDate(), parts[0], parts[1]);
	if(today.getTime() < begin.getTime() || today.getTime() > end.getTime()) {
		return false;
	}
	if(today.getTime() < begin_daily.getTime() || today.getTime() > end_daily.getTime()) {
		return false;
	}
	return true;
}
items.data.features.forEach(function (marker) {
	if(visibleNow(marker)){
	    var el = document.createElement('div');
        el.className = 'marker';
		el.style.width = marker.properties.iconSize[0] + 'px';
        el.style.height = marker.properties.iconSize[1] + 'px';
		el.style.backgroundImage = 'url(\'' + marker.properties.icon + '\')';
		deg = 90;
		
		/*el.style.webkitTransform = 'rtate('+deg+'deg)'; 
		el.style.mozTransform = 'rtate('+deg+'deg)'; 
		el.style.msTransform = 'rtate('+deg+'deg)'; 
		el.style.oTransform = 'rtate('+ deg+'deg)'; 
		el.style.transform = 'rtate('+ deg+'deg)';
		
		el.style['transform'] = 'rotate(30deg)';

		el.style['-ms-transform'] = 'rotate(30deg)'; // IE
		el.style['-moz-transform'] = 'rotate(30deg)'; // Firefox
		el.style['-webkit-transform'] = 'rotate(30deg)'; // Chrome
		el.style['-o-transform'] = 'rotate(30deg)'; // Opera*/
	
		

		var popup = new mapboxgl.Popup({ offset: marker.properties.iconSize[1]/2 + 2 }).setHTML(
			marker.properties.description + '<div/>'
		);
 
 
		new mapboxgl.Marker(el)
		.setLngLat(marker.geometry.coordinates)
		.setPopup(popup) // sets a popup on this marker
		.addTo(map);
		

	}
		

    });

class ResetButton {
  onAdd(map){
    this.map = map;
    this.container = document.createElement('div');
	this.container.style.backgroundSize = 'cover';
	this.container.style.backgroundImage = 'url(https://image.flaticon.com/icons/png/512/128/128223.png)';
	this.container.style.width = '25px';
	this.container.style.height = '25px';
    this.container.style.margin = '1em 1em 0em 0em';
    this.container.className = 'mapboxgl-ctrl';
    const button = this._createButton('button2')
    this.container.appendChild(button);
    return this.container;
  }
  onRemove(){
    this.container.parentNode.removeChild(this.container);
    this.map = undefined;
  }
  
  _createButton(className) {
    const el = window.document.createElement('button')
    el.className = className;
    el.addEventListener('click',(e)=>{
		this.map.flyTo({
center: [8.349325060844421, 49.01890053442718],
essential: true // this animation is considered essential with respect to prefers-reduced-motion
});
    },false )
    return el;
  }
}



class AboutButton {
  onAdd(map){
    this.map = map;
    this.container = document.createElement('div');
	this.container.style.backgroundSize = 'cover';
	this.container.style.backgroundImage = 'url(https://image.flaticon.com/icons/png/512/128/157933.png)';
	this.container.style.width = '25px';
	this.container.style.height = '25px';
    this.container.style.margin = '1em 1em 0em 0em';
    this.container.className = 'mapboxgl-ctrl';
    const button = this._createButton('button2')
    this.container.appendChild(button);
    return this.container;
  }
  onRemove(){
    this.container.parentNode.removeChild(this.container);
    this.map = undefined;
  }
  
  _createButton(className) {
    const el = window.document.createElement('button')
    el.className = className;
    el.addEventListener('click',(e)=>{
  let overlayDiv = document.querySelector(".overlay");
  console.log(overlayDiv.style.opacity);
  if (overlayDiv.style.opacity === '0')
    overlayDiv.style.opacity = 1;
  else
    overlayDiv.style.opacity = 0;},false )
    return el;
  }
}

const resetButton = new ResetButton();
map.addControl(resetButton);

const aboutButton = new AboutButton();
map.addControl(aboutButton);



</script>

<div class="overlay" style="opacity: 0;">
<button  class = "innerbutton" onclick="document.querySelector('.overlay').style.opacity = 0">close</button>
Hier steht ein interessanter Text über unser Projekt. <br> Und darüber, wer wir sind und was wir machen. <br> Ganz tolle Sachen nämlich. <br> Außerdem gibt es Kuchen.  <br> Vielleicht. <br> </div>

</body>
</html>